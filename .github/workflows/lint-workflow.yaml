name: Lint Workflow
on:
  pull_request: {}
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
    lint:
        outputs:
          linter_results: ${{ steps.extract_files.outputs.lint_results }}
        runs-on: ubuntu-latest
        permissions:
            contents: read
            packages: read
            statuses: write
        steps:
        - name: Checkout code
          uses: actions/checkout@v5
          with:
            fetch-depth: 0
            persist-credentials: false
        - name: Run Super Linter
          uses: github/super-linter@v4
          env:
            VALIDATE_YAML: true
            VALIDATE_PYTHON_BLACK: true
            VALIDATE_TYPESCRIPT_ES: true
            VALIDATE_DOCKERFILE_HADOLINT: true
            VALIDATE_BASH: true
            VALIDATE_JSON: true
            VALIDATE_ALL_CODEBASE: false
            SAVE_SUPER_LINTER_SUMMARY: true
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            DEFAULT_BRANCH: ${{ github.base_ref }}
        - name: Extract linter summary
          id: extract_files
          run: |
            cat super-linter.log
            LINT_FILE="lint_results.txt"
            echo "## âŒ Files with Failures or Warnings ##" > $LINT_FILE
            grep -E 'FAILED|WARNING' super-linter.log | awk '{print $1}' >> $LINT_FILE
            echo "lint_results<<EOF" >> $GITHUB_OUTPUT
            cat lint_results.txt >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT

    add-pr-comment:
        runs-on: ubuntu-latest
        needs: lint
        permissions:
          pull-requests: write
        steps:  
        - name: Add PR comment with linter results
          if: always()
          uses: mshick/add-pr-comment@v2
          with:
            message: |
              ðŸ¤– Linter results:
                ${{ needs.lint.outputs.linter_results }}
